<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Answer Sheet Checking Ledger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Section -->
    <div id="loginSection" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-md w-96">
            <h2 class="text-2xl font-bold mb-6 text-center">Answer Sheet Checking Ledger</h2>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="username" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Role</label>
                    <select id="role" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        <option value="admin">Admin</option>
                        <option value="teacher">Teacher</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700">Login</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden">
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <span class="text-xl font-bold">Admin Dashboard</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="adminUsername" class="text-gray-700"></span>
                        <button onclick="logout()" class="text-gray-700 hover:text-gray-900">
                            <i class="bi bi-box-arrow-right text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="mb-6 flex flex-wrap gap-4">
                <button id="showTeacherSection" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Manage Teachers</button>
                <button id="showExamSection" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Define Exams</button>
                <button id="showAssignSection" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Assign Bundles</button>
                <button id="showStandardsSection" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Manage Standards & Subjects</button>
                <button id="showAnalyticsSection" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Analytics</button>
            </div>

            <!-- Add Teacher Section -->
            <div id="teacherSection" class="admin-section bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-lg font-semibold mb-4">Add Teacher</h3>
                <form id="addTeacherForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Name</label>
                        <input type="text" id="teacherName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Username</label>
                        <input type="text" id="teacherUsername" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="teacherPassword" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Classes</label>
                        <select id="teacherClasses" multiple class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Subjects</label>
                        <select id="teacherSubjects" multiple class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Add Teacher</button>
                </form>
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4">Teacher List</h3>
                    <div id="teacherList" class="space-y-2">
                        <!-- Teacher list will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Define Exam Section -->
            <div id="examSection" class="admin-section bg-white p-6 rounded-lg shadow mb-6 hidden">
                <h3 class="text-lg font-semibold mb-4">Define Exam</h3>
                <form id="defineExamForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Exam Name</label>
                        <input type="text" id="examName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Date</label>
                        <input type="date" id="examDate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Time</label>
                        <input type="time" id="examTime" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Class</label>
                        <select id="examClass" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Subject</label>
                        <select id="examSubject" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Number of Students</label>
                        <input type="number" id="examStudentCount" min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                    </div>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Define Exam</button>
                </form>
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4">Exam Schedule</h3>
                    <div id="examList" class="space-y-2">
                        <!-- Exam list will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Assign Bundle Section -->
            <div id="assignSection" class="admin-section bg-white p-6 rounded-lg shadow mb-6 hidden">
                <h3 class="text-lg font-semibold mb-4">Assign Answer Sheet Bundles</h3>
                <form id="assignBundleForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Exam</label>
                        <select id="bundleExam" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Teacher</label>
                        <select id="bundleTeacher" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Bundle Description (optional)</label>
                        <input type="text" id="bundleDescription" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Assign Bundle</button>
                </form>
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4">Assigned Bundles</h3>
                    <div id="bundleList" class="space-y-2">
                        <!-- Bundle list will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Manage Standards & Subjects Section -->
            <div id="standardsSection" class="admin-section bg-white p-6 rounded-lg shadow mb-6 hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Add Standard</h3>
                        <form id="addStandardForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Standard Name</label>
                                <input type="text" id="standardName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            </div>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Add Standard</button>
                        </form>
                        <div class="mt-4">
                            <h4 class="text-md font-medium mb-2">Standard List</h4>
                            <ul id="standardList" class="list-disc pl-5">
                                <!-- Standards will be listed here -->
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Add Subject</h3>
                        <form id="addSubjectForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Subject Name</label>
                                <input type="text" id="subjectName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                            </div>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">Add Subject</button>
                        </form>
                        <div class="mt-4">
                            <h4 class="text-md font-medium mb-2">Subject List</h4>
                            <ul id="subjectList" class="list-disc pl-5">
                                <!-- Subjects will be listed here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analyticsSection" class="admin-section bg-white p-6 rounded-lg shadow hidden">
                <h3 class="text-lg font-semibold mb-4">Analytics</h3>
                <div class="space-y-6">
                    <div>
                        <h4 class="text-md font-medium text-gray-700">Overall Progress</h4>
                        <div class="mt-2 h-6 bg-gray-200 rounded-full overflow-hidden">
                            <div id="overallProgressBar" class="h-6 bg-green-500 flex items-center justify-center text-white text-xs" style="width: 0%">0%</div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-md font-medium text-gray-700">Bundle Status</h4>
                        <div class="mt-2 grid grid-cols-3 gap-4 text-center">
                            <div class="bg-blue-100 p-3 rounded-lg">
                                <div id="receivedCount" class="text-xl font-bold text-blue-700">0</div>
                                <div class="text-sm text-gray-600">Received</div>
                            </div>
                            <div class="bg-yellow-100 p-3 rounded-lg">
                                <div id="checkedCount" class="text-xl font-bold text-yellow-700">0</div>
                                <div class="text-sm text-gray-600">Checked</div>
                            </div>
                            <div class="bg-green-100 p-3 rounded-lg">
                                <div id="updatedCount" class="text-xl font-bold text-green-700">0</div>
                                <div class="text-sm text-gray-600">Marks Updated</div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-md font-medium text-gray-700">Teacher Checking Speed</h4>
                        <div id="teacherSpeedList" class="mt-2 space-y-3">
                            <!-- Teacher speeds will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Teacher Dashboard -->
    <div id="teacherDashboard" class="hidden">
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <span class="text-xl font-bold">Teacher Dashboard</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="teacherWelcome" class="text-gray-700"></span>
                        <button onclick="logout()" class="text-gray-700 hover:text-gray-900">
                            <i class="bi bi-box-arrow-right text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-lg font-semibold mb-4">My Answer Sheet Bundles</h3>
                <div id="teacherBundleList" class="space-y-4">
                    <!-- Teacher's bundles will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        const data = {
            currentUser: null,
            teachers: [],
            standards: [],
            subjects: [],
            exams: [],
            bundles: []
        };

        // Add default admin user
        const defaultUsers = {
            admin: { username: 'admin', password: 'admin', role: 'admin' },
            teacher: { username: 'teacher', password: 'teacher', role: 'teacher', name: 'Demo Teacher', classes: ['Class 6'], subjects: ['Mathematics'] }
        };

        // Add default teacher to the list
        data.teachers.push({
            id: Date.now(),
            name: defaultUsers.teacher.name,
            username: defaultUsers.teacher.username,
            password: defaultUsers.teacher.password,
            classes: defaultUsers.teacher.classes,
            subjects: defaultUsers.teacher.subjects
        });

        // Add default standards and subjects
        for (let i = 6; i <= 10; i++) {
            data.standards.push(`Class ${i}`);
        }
        data.subjects = ['Mathematics', 'Science', 'English', 'History', 'Geography'];

        // Tab navigation for admin
        document.getElementById('showTeacherSection').addEventListener('click', showSection);
        document.getElementById('showExamSection').addEventListener('click', showSection);
        document.getElementById('showAssignSection').addEventListener('click', showSection);
        document.getElementById('showStandardsSection').addEventListener('click', showSection);
        document.getElementById('showAnalyticsSection').addEventListener('click', showSection);

        function showSection(e) {
            const sections = document.querySelectorAll('.admin-section');
            sections.forEach(section => section.classList.add('hidden'));
            
            const buttonId = e.target.id;
            if (buttonId === 'showTeacherSection') {
                document.getElementById('teacherSection').classList.remove('hidden');
            } else if (buttonId === 'showExamSection') {
                document.getElementById('examSection').classList.remove('hidden');
            } else if (buttonId === 'showAssignSection') {
                document.getElementById('assignSection').classList.remove('hidden');
                populateAssignDropdowns();
            } else if (buttonId === 'showStandardsSection') {
                document.getElementById('standardsSection').classList.remove('hidden');
                renderStandardsList();
                renderSubjectsList();
            } else if (buttonId === 'showAnalyticsSection') {
                document.getElementById('analyticsSection').classList.remove('hidden');
                updateAnalytics();
            }
        }

        // Authentication
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const role = document.getElementById('role').value;
            
            let authenticated = false;
            
            if (role === 'admin' && username === defaultUsers.admin.username && password === defaultUsers.admin.password) {
                authenticated = true;
                data.currentUser = { ...defaultUsers.admin };
                showAdminDashboard();
            } else if (role === 'teacher') {
                const teacher = data.teachers.find(t => t.username === username && t.password === password);
                if (teacher) {
                    authenticated = true;
                    data.currentUser = { ...teacher, role: 'teacher' };
                    showTeacherDashboard();
                }
            }
            
            if (!authenticated) {
                alert('Invalid credentials');
            }
        });

        function showAdminDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
            document.getElementById('teacherDashboard').classList.add('hidden');
            document.getElementById('adminUsername').textContent = `Welcome, ${data.currentUser.username}`;
            
            populateStandardsDropdown();
            populateSubjectsDropdown();
            renderTeacherList();
            renderExamList();
            renderBundleList();
            updateAnalytics();
        }

        function showTeacherDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('teacherDashboard').classList.remove('hidden');
            document.getElementById('teacherWelcome').textContent = `Welcome, ${data.currentUser.name}`;
            
            renderTeacherBundles();
        }

        function logout() {
            data.currentUser = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('teacherDashboard').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        // Populate dropdowns with standards and subjects
        function populateStandardsDropdown() {
            const standardsDropdowns = [
                document.getElementById('teacherClasses'),
                document.getElementById('examClass')
            ];
            
            standardsDropdowns.forEach(dropdown => {
                if (dropdown) {
                    dropdown.innerHTML = '';
                    data.standards.forEach(standard => {
                        const option = document.createElement('option');
                        option.value = standard;
                        option.textContent = standard;
                        dropdown.appendChild(option);
                    });
                }
            });
        }

        function populateSubjectsDropdown() {
            const subjectsDropdowns = [
                document.getElementById('teacherSubjects'),
                document.getElementById('examSubject')
            ];
            
            subjectsDropdowns.forEach(dropdown => {
                if (dropdown) {
                    dropdown.innerHTML = '';
                    data.subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        dropdown.appendChild(option);
                    });
                }
            });
        }

        function populateAssignDropdowns() {
            // Populate exam dropdown
            const examDropdown = document.getElementById('bundleExam');
            examDropdown.innerHTML = '';
            data.exams.forEach(exam => {
                const option = document.createElement('option');
                option.value = exam.id;
                option.textContent = `${exam.name} - ${exam.class} - ${exam.subject}`;
                examDropdown.appendChild(option);
            });

            // Populate teacher dropdown
            const teacherDropdown = document.getElementById('bundleTeacher');
            teacherDropdown.innerHTML = '';
            data.teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.id;
                option.textContent = teacher.name;
                teacherDropdown.appendChild(option);
            });
        }

        // Form submissions
        document.getElementById('addTeacherForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('teacherName').value;
            const username = document.getElementById('teacherUsername').value;
            const password = document.getElementById('teacherPassword').value;
            
            // Get selected classes (multiple)
            const classesSelect = document.getElementById('teacherClasses');
            const classes = Array.from(classesSelect.selectedOptions).map(option => option.value);
            
            // Get selected subjects (multiple)
            const subjectsSelect = document.getElementById('teacherSubjects');
            const subjects = Array.from(subjectsSelect.selectedOptions).map(option => option.value);
            
            // Validate that at least one class and subject are selected
            if (classes.length === 0 || subjects.length === 0) {
                alert('Please select at least one class and one subject');
                return;
            }
            
            const newTeacher = {
                id: Date.now(),
                name,
                username,
                password,
                classes,
                subjects
            };
            
            data.teachers.push(newTeacher);
            renderTeacherList();
            this.reset();
            alert('Teacher added successfully!');
        });

        document.getElementById('defineExamForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('examName').value;
            const date = document.getElementById('examDate').value;
            const time = document.getElementById('examTime').value;
            const examClass = document.getElementById('examClass').value;
            const subject = document.getElementById('examSubject').value;
            const studentCount = parseInt(document.getElementById('examStudentCount').value);
            
            const newExam = {
                id: Date.now(),
                name,
                date,
                time,
                class: examClass,
                subject,
                studentCount
            };
            
            data.exams.push(newExam);
            renderExamList();
            this.reset();
            alert('Exam defined successfully!');
        });
        
        document.getElementById('assignBundleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const examId = parseInt(document.getElementById('bundleExam').value);
            const teacherId = parseInt(document.getElementById('bundleTeacher').value);
            const description = document.getElementById('bundleDescription').value;
            
            const exam = data.exams.find(e => e.id === examId);
            const teacher = data.teachers.find(t => t.id === teacherId);
            
            // Validate that teacher teaches the class and subject
            if (!teacher.classes.includes(exam.class) || !teacher.subjects.includes(exam.subject)) {
                alert('This teacher does not teach this class or subject');
                return;
            }
            
            const newBundle = {
                id: Date.now(),
                examId,
                teacherId,
                description,
                status: {
                    received: false,
                    checked: false,
                    marksUpdated: false
                },
                startTime: null,
                endTime: null
            };
            
            data.bundles.push(newBundle);
            renderBundleList();
            this.reset();
            updateAnalytics();
            alert('Bundle assigned successfully!');
        });

        document.getElementById('addStandardForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const standardName = document.getElementById('standardName').value;
            
            if (data.standards.includes(standardName)) {
                alert('This standard already exists');
                return;
            }
            
            data.standards.push(standardName);
            renderStandardsList();
            populateStandardsDropdown();
            this.reset();
            alert('Standard added successfully!');
        });

        document.getElementById('addSubjectForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const subjectName = document.getElementById('subjectName').value;
            
            if (data.subjects.includes(subjectName)) {
                alert('This subject already exists');
                return;
            }
            
            data.subjects.push(subjectName);
            renderSubjectsList();
            populateSubjectsDropdown();
            this.reset();
            alert('Subject added successfully!');
        });

        // Rendering functions
        function renderTeacherList() {
            const teacherList = document.getElementById('teacherList');
            teacherList.innerHTML = '';
            
            data.teachers.forEach(teacher => {
                const div = document.createElement('div');
                div.className = 'border p-4 rounded-lg mb-2';
                div.innerHTML = `
                    <h4 class="font-medium">${teacher.name}</h4>
                    <p class="text-sm text-gray-600">Username: ${teacher.username}</p>
                    <p class="text-sm text-gray-600">Classes: ${teacher.classes.join(', ')}</p>
                    <p class="text-sm text-gray-600">Subjects: ${teacher.subjects.join(', ')}</p>
                `;
                teacherList.appendChild(div);
            });
        }

        function renderExamList() {
            const examList = document.getElementById('examList');
            examList.innerHTML = '';
            
            data.exams.forEach(exam => {
                const div = document.createElement('div');
                div.className = 'border p-4 rounded-lg mb-2';
                div.innerHTML = `
                    <h4 class="font-medium">${exam.name}</h4>
                    <p class="text-sm text-gray-600">Date: ${exam.date} at ${exam.time}</p>
                    <p class="text-sm text-gray-600">Class: ${exam.class}</p>
                    <p class="text-sm text-gray-600">Subject: ${exam.subject}</p>
                    <p class="text-sm text-gray-600">Students: ${exam.studentCount}</p>
                `;
                examList.appendChild(div);
            });
        }

        function renderBundleList() {
            const bundleList = document.getElementById('bundleList');
            bundleList.innerHTML = '';
            
            data.bundles.forEach(bundle => {
                const exam = data.exams.find(e => e.id === bundle.examId);
                const teacher = data.teachers.find(t => t.id === bundle.teacherId);
                
                if (!exam || !teacher) return;
                
                const div = document.createElement('div');
                div.className = 'border p-4 rounded-lg mb-2';
                div.innerHTML = `
                    <h4 class="font-medium">${exam.name} - ${exam.class} - ${exam.subject}</h4>
                    <p class="text-sm text-gray-600">Teacher: ${teacher.name}</p>
                    ${bundle.description ? `<p class="text-sm text-gray-600">Description: ${bundle.description}</p>` : ''}
                    <div class="mt-2 space-x-2">
                        <span class="${bundle.status.received ? 'text-green-600' : 'text-red-600'}">
                            <i class="bi ${bundle.status.received ? 'bi-check-circle-fill' : 'bi-x-circle-fill'}"></i> Received
                        </span>
                        <span class="${bundle.status.checked ? 'text-green-600' : 'text-red-600'}">
                            <i class="bi ${bundle.status.checked ? 'bi-check-circle-fill' : 'bi-x-circle-fill'}"></i> Checked
                        </span>
                        <span class="${bundle.status.marksUpdated ? 'text-green-600' : 'text-red-600'}">
                            <i class="bi ${bundle.status.marksUpdated ? 'bi-check-circle-fill' : 'bi-x-circle-fill'}"></i> Marks Updated
                        </span>
                    </div>
                `;
                bundleList.appendChild(div);
            });
        }

        function renderTeacherBundles() {
            const bundleList = document.getElementById('teacherBundleList');
            bundleList.innerHTML = '';
            
            const teacherBundles = data.bundles.filter(bundle => bundle.teacherId === data.currentUser.id);
            
            if (teacherBundles.length === 0) {
                bundleList.innerHTML = '<p>No bundles assigned to you yet.</p>';
                return;
            }
            
            teacherBundles.forEach(bundle => {
                const exam = data.exams.find(e => e.id === bundle.examId);
                
                if (!exam) return;
                
                const div = document.createElement('div');
                div.className = 'border p-4 rounded-lg';
                div.innerHTML = `
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center">
                        <div>
                            <h4 class="font-medium">${exam.class} - ${exam.subject}</h4>
                            <p class="text-sm text-gray-600">${exam.name}</p>
                            ${bundle.description ? `<p class="text-sm text-gray-600">${bundle.description}</p>` : ''}
                        </div>
                        <div class="mt-3 md:mt-0 space-y-2 md:space-y-0 md:space-x-3 flex flex-col md:flex-row items-start md:items-center">
                            <label class="inline-flex items-center">
                                <input type="checkbox" data-bundle-id="${bundle.id}" data-status="received" class="form-checkbox bundle-status" 
                                       ${bundle.status.received ? 'checked' : ''} onchange="updateBundleStatus(this)">
                                <span class="ml-2 text-sm">Received</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="checkbox" data-bundle-id="${bundle.id}" data-status="checked" class="form-checkbox bundle-status" 
                                       ${bundle.status.checked ? 'checked' : ''} ${!bundle.status.received ? 'disabled' : ''} onchange="updateBundleStatus(this)">
                                <span class="ml-2 text-sm">Checked</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="checkbox" data-bundle-id="${bundle.id}" data-status="marksUpdated" class="form-checkbox bundle-status" 
                                       ${bundle.status.marksUpdated ? 'checked' : ''} ${!bundle.status.checked ? 'disabled' : ''} onchange="updateBundleStatus(this)">
                                <span class="ml-2 text-sm">Marks Updated</span>
                            </label>
                        </div>
                    </div>
                `;
                bundleList.appendChild(div);
            });
        }

        function renderStandardsList() {
            const standardList = document.getElementById('standardList');
            standardList.innerHTML = '';
            
            data.standards.forEach(standard => {
                const li = document.createElement('li');
                li.textContent = standard;
                standardList.appendChild(li);
            });
        }

        function renderSubjectsList() {
            const subjectList = document.getElementById('subjectList');
            subjectList.innerHTML = '';
            
            data.subjects.forEach(subject => {
                const li = document.createElement('li');
                li.textContent = subject;
                subjectList.appendChild(li);
            });
        }

        // Update bundle status when teacher checks boxes
        function updateBundleStatus(checkbox) {
            const bundleId = parseInt(checkbox.dataset.bundleId);
            const status = checkbox.dataset.status;
            const checked = checkbox.checked;
            
            const bundle = data.bundles.find(b => b.id === bundleId);
            if (bundle) {
                // If unchecking "received", also uncheck the other statuses
                if (status === 'received' && !checked) {
                    bundle.status.received = false;
                    bundle.status.checked = false;
                    bundle.status.marksUpdated = false;
                    // If unchecking "checked", also uncheck "marksUpdated"
                } else if (status === 'checked' && !checked) {
                    bundle.status.checked = false;
                    bundle.status.marksUpdated = false;
                } else {
                    bundle.status[status] = checked;
                    
                    // Track the time for checking speed calculation
                    if (status === 'received' && checked) {
                        bundle.startTime = new Date();
                    } else if (status === 'checked' && checked) {
                        bundle.endTime = new Date();
                    }
                }
                
                renderTeacherBundles();
                
                // If admin is viewing analytics, update them
                if (document.getElementById('analyticsSection').classList.contains('hidden') === false) {
                    updateAnalytics();
                }
            }
        }

        // Update analytics dashboard
        function updateAnalytics() {
            // Calculate overall progress
            const totalBundles = data.bundles.length;
            let receivedCount = 0;
            let checkedCount = 0;
            let updatedCount = 0;
            
            if (totalBundles === 0) {
                document.getElementById('overallProgressBar').style.width = '0%';
                document.getElementById('overallProgressBar').textContent = '0%';
                document.getElementById('receivedCount').textContent = '0';
                document.getElementById('checkedCount').textContent = '0';
                document.getElementById('updatedCount').textContent = '0';
                document.getElementById('teacherSpeedList').innerHTML = '<p>No data available yet</p>';
                return;
            }
            
            // Count status totals
            data.bundles.forEach(bundle => {
                if (bundle.status.received) receivedCount++;
                if (bundle.status.checked) checkedCount++;
                if (bundle.status.marksUpdated) updatedCount++;
            });
            
            // Update progress bar
            const overallProgress = Math.round((updatedCount / totalBundles) * 100);
            document.getElementById('overallProgressBar').style.width = `${overallProgress}%`;
            document.getElementById('overallProgressBar').textContent = `${overallProgress}%`;
            
            // Update status counts
            document.getElementById('receivedCount').textContent = receivedCount;
            document.getElementById('checkedCount').textContent = checkedCount;
            document.getElementById('updatedCount').textContent = updatedCount;
            
            // Calculate teacher speeds
            const teacherSpeedData = {};
            
            data.bundles.forEach(bundle => {
                if (bundle.status.checked && bundle.startTime && bundle.endTime) {
                    const teacher = data.teachers.find(t => t.id === bundle.teacherId);
                    const exam = data.exams.find(e => e.id === bundle.examId);
                    
                    if (!teacher || !exam) return;
                    
                    // Calculate time taken in hours
                    const timeTaken = (bundle.endTime - bundle.startTime) / (1000 * 60 * 60);
                    // Calculate papers per hour
                    const papersPerHour = Math.round(exam.studentCount / timeTaken);
                    
                    if (!teacherSpeedData[teacher.id]) {
                        teacherSpeedData[teacher.id] = {
                            name: teacher.name,
                            bundles: 1,
                            totalSpeed: papersPerHour
                        };
                    } else {
                        teacherSpeedData[teacher.id].bundles++;
                        teacherSpeedData[teacher.id].totalSpeed += papersPerHour;
                    }
                }
            });
            
            // Render teacher speeds
            const teacherSpeedList = document.getElementById('teacherSpeedList');
            teacherSpeedList.innerHTML = '';
            
            if (Object.keys(teacherSpeedData).length === 0) {
                teacherSpeedList.innerHTML = '<p>No checking speed data available yet</p>';
                return;
            }
            
            Object.values(teacherSpeedData).forEach(data => {
                const avgSpeed = Math.round(data.totalSpeed / data.bundles);
                
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center border-b pb-2';
                div.innerHTML = `
                    <span>${data.name}</span>
                    <span class="font-medium">${avgSpeed} papers/hour</span>
                `;
                teacherSpeedList.appendChild(div);
            });
        }

        // Initial setup
        populateStandardsDropdown();
        populateSubjectsDropdown();
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>